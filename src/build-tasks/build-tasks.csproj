<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <AssemblyName>neo-build-tasks</AssemblyName>
        <PackageId>Neo.BuildTasks</PackageId>
        <TargetFrameworks>net9.0;netstandard2.0</TargetFrameworks>

        <BuildOutputTargetFolder>tasks</BuildOutputTargetFolder>
        <IsPackable>true</IsPackable>

        <DevelopmentDependency>true</DevelopmentDependency>
        <NoPackageAnalysis>true</NoPackageAnalysis>
        <Nullable>enable</Nullable>
        <ImplicitUsings>disable</ImplicitUsings>
    </PropertyGroup>

    <ItemGroup>
        <InternalsVisibleTo Include="test-build-tasks" />
    </ItemGroup>

    <ItemGroup>
        <Content Include="build\*" Pack="true" PackagePath="build\" Condition="Exists('build')" />
        <Content Include="buildMultiTargeting\*" Pack="true" PackagePath="buildMultiTargeting\" Condition="Exists('buildMultiTargeting')" />
    </ItemGroup>

    <Target Name="PackTaskBinaries"
            DependsOnTargets="Build"
            BeforeTargets="GetPackageContents">
        <!-- $(TargetDir) == bin/$(Configuration)/$(TargetFramework)/ -->
        <ItemGroup>
            <TfmSpecificPackageFile Include="$(TargetDir)$(AssemblyName).dll">
                <PackagePath>tasks/$(TargetFramework)/</PackagePath>
            </TfmSpecificPackageFile>
        </ItemGroup>
        <Message Importance="High"
                 Text="Empaquetando $(TargetFramework): $(TargetDir)$(AssemblyName).dll → tasks/$(TargetFramework)/" />
    </Target>

    <ItemGroup>
        <PackageReference Include="Microsoft.Build.Utilities.Core" Version="17.14.8" PrivateAssets="All" />
        <PackageReference Include="PolySharp" Version="1.15.0">
            <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
            <PrivateAssets>all</PrivateAssets>
        </PackageReference>
        <PackageReference Update="Nerdbank.GitVersioning" Version="3.7.115" />
    </ItemGroup>

</Project>